# ApolloInn é¡¹ç›®ç»“æ„

```text
.
â”œâ”€â”€ server/                          # ğŸ”¥ ç½‘å…³æœåŠ¡å™¨ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”œâ”€â”€ app.py                       #   FastAPI å…¥å£
â”‚   â”œâ”€â”€ routes/                      #   è·¯ç”±å±‚
â”‚   â”‚   â”œâ”€â”€ proxy.py                 #     OpenAI å…¼å®¹è½¬å‘ï¼ˆä¸»è¯·æ±‚ç®¡çº¿ï¼‰
â”‚   â”‚   â”œâ”€â”€ admin.py                 #     ç®¡ç†å‘˜ API
â”‚   â”‚   â””â”€â”€ user.py                  #     ç”¨æˆ· API
â”‚   â”œâ”€â”€ services/                    #   ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ token_pool.py            #     Token æ±  + ç”¨æˆ·ç®¡ç†ï¼ˆPostgreSQLï¼‰
â”‚   â”‚   â”œâ”€â”€ auth_bridge.py           #     Token â†’ AuthManager æ¡¥æ¥
â”‚   â”‚   â”œâ”€â”€ cursor_auth.py           #     Cursor è®¤è¯å·¥å…·
â”‚   â”‚   â””â”€â”€ cursor_utils.py          #     Cursor å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ db/                          #   æ•°æ®åº“
â”‚   â”‚   â””â”€â”€ schema.sql               #     DDL å»ºè¡¨è„šæœ¬
â”‚   â”œâ”€â”€ core/                        #   Kiro API æ ¸å¿ƒåº“ï¼ˆä¸Šæ¸¸ kiro-gatewayï¼‰
â”‚   â”‚   â”œâ”€â”€ config.py                #     å…¨å±€é…ç½®
â”‚   â”‚   â”œâ”€â”€ context_compression.py   #     æ™ºèƒ½ä¸Šä¸‹æ–‡å‹ç¼©ï¼ˆtree-sitter ASTï¼‰
â”‚   â”‚   â”œâ”€â”€ converters_openai.py     #     OpenAI â†” Kiro æ ¼å¼è½¬æ¢
â”‚   â”‚   â”œâ”€â”€ converters_core.py       #     æ ¸å¿ƒæ¶ˆæ¯è½¬æ¢
â”‚   â”‚   â”œâ”€â”€ streaming_openai.py      #     æµå¼å“åº”å¤„ç†
â”‚   â”‚   â”œâ”€â”€ streaming_core.py        #     æµå¼æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ auth.py                  #     Kiro è®¤è¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ http_client.py           #     HTTP å®¢æˆ·ç«¯ï¼ˆé‡è¯•ã€è¶…æ—¶ï¼‰
â”‚   â”‚   â”œâ”€â”€ thinking_parser.py       #     Fake Reasoning è§£æ
â”‚   â”‚   â”œâ”€â”€ truncation_recovery.py   #     æˆªæ–­æ¢å¤
â”‚   â”‚   â”œâ”€â”€ truncation_state.py      #     æˆªæ–­çŠ¶æ€è¿½è¸ª
â”‚   â”‚   â”œâ”€â”€ model_resolver.py        #     æ¨¡å‹åˆ«åè§£æ
â”‚   â”‚   â”œâ”€â”€ models_openai.py         #     OpenAI æ•°æ®æ¨¡å‹ï¼ˆPydanticï¼‰
â”‚   â”‚   â”œâ”€â”€ parsers.py               #     Kiro äº‹ä»¶è§£æ
â”‚   â”‚   â”œâ”€â”€ cache.py                 #     æ¨¡å‹ä¿¡æ¯ç¼“å­˜
â”‚   â”‚   â”œâ”€â”€ tokenizer.py             #     Token è®¡æ•°
â”‚   â”‚   â”œâ”€â”€ debug_logger.py          #     è°ƒè¯•æ—¥å¿—
â”‚   â”‚   â”œâ”€â”€ kiro_errors.py           #     Kiro é”™è¯¯ç æ˜ å°„
â”‚   â”‚   â”œâ”€â”€ network_errors.py        #     ç½‘ç»œé”™è¯¯å¤„ç†
â”‚   â”‚   â”œâ”€â”€ exceptions.py            #     å¼‚å¸¸å®šä¹‰
â”‚   â”‚   â””â”€â”€ utils.py                 #     å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ .env.example
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ admin/                           # ğŸ–¥ï¸ ç®¡ç†å‘˜å‰ç«¯ï¼ˆReact + Viteï¼‰
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ views/                   #   é¡µé¢ï¼šOverview, Tokens, Users, Models, Usage
â”‚       â”œâ”€â”€ components/              #   ç»„ä»¶ï¼šHeader, Sidebar, Modal, Toasts
â”‚       â”œâ”€â”€ store/                   #   çŠ¶æ€ï¼šapp, auth
â”‚       â””â”€â”€ styles/                  #   æ ·å¼
â”‚
â”œâ”€â”€ user/                            # ğŸ–¥ï¸ ç”¨æˆ·å‰ç«¯ï¼ˆReact + Viteï¼‰
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ views/                   #   é¡µé¢ï¼šDashboard, Login
â”‚       â”œâ”€â”€ components/              #   ç»„ä»¶ï¼šModal, Toasts
â”‚       â”œâ”€â”€ store/                   #   çŠ¶æ€ï¼šapp, auth
â”‚       â””â”€â”€ styles/                  #   æ ·å¼
â”‚
â”œâ”€â”€ client/                          # ğŸ“¦ ç”¨æˆ·ç«¯å·¥å…·
â”‚   â”œâ”€â”€ agent/                       #   æ¡Œé¢ Agent
â”‚   â”‚   â”œâ”€â”€ main.py                  #     ä¸»ç¨‹åºï¼ˆHTTP æœåŠ¡ + åŸç”Ÿçª—å£ï¼‰
â”‚   â”‚   â”œâ”€â”€ ui.py                    #     å†…åµŒ HTML é¡µé¢
â”‚   â”‚   â”œâ”€â”€ cursor_auth.py           #     Cursor è®¤è¯
â”‚   â”‚   â””â”€â”€ cursor_utils.py          #     Cursor å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ setup/                       #   é…ç½®å·¥å…·
â”‚   â”‚   â”œâ”€â”€ auto_setup.js            #     9router è‡ªåŠ¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ setup_page.js            #     9router é…ç½®é¡µé¢
â”‚   â”‚   â”œâ”€â”€ patch_cursor.py          #     Cursor JS è¡¥ä¸
â”‚   â”‚   â”œâ”€â”€ full_setup.py            #     ä¸€é”®é…ç½®è„šæœ¬
â”‚   â”‚   â””â”€â”€ upload_creds.py          #     ä¸Šä¼ å‡­è¯
â”‚   â”œâ”€â”€ build/                       #   æ‰“åŒ…é…ç½®ï¼ˆPyInstallerï¼‰
â”‚   â”‚   â””â”€â”€ BUILD_GUIDE.md          #     æ„å»ºæŒ‡å—
â”‚   â”œâ”€â”€ dist/                        #   æ‰“åŒ…äº§ç‰©ï¼ˆ.dmg / .exeï¼‰
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ scripts/                         # ğŸ”§ è¿ç»´/åˆ†æè„šæœ¬
â”‚   â”œâ”€â”€ import_tokens.py             #   å¯¼å…¥ Token åˆ°æ•°æ®åº“
â”‚   â”œâ”€â”€ validate_accounts.py         #   æ‰¹é‡éªŒè¯è´¦å·æœ‰æ•ˆæ€§
â”‚   â”œâ”€â”€ analyze_trace.py             #   Trace æ—¥å¿—åˆ†æ
â”‚   â””â”€â”€ ...                          #   å…¶ä»–åˆ†æè„šæœ¬
â”‚
â”œâ”€â”€ tests/                           # ğŸ§ª æµ‹è¯•
â”‚   â”œâ”€â”€ captured_requests/           #   çœŸå®ç”¨æˆ·è¯·æ±‚æ ·æœ¬ï¼ˆå‹ç¼©ç®—æ³•æµ‹è¯•æ•°æ®ï¼‰
â”‚   â””â”€â”€ test_*.py                    #   å‹ç¼©ç®—æ³•æµ‹è¯•è„šæœ¬
â”‚
â”œâ”€â”€ proxy/                          # ğŸŒ ä»£ç†èŠ‚ç‚¹é…ç½®æ¨¡æ¿
â”‚   â”œâ”€â”€ xray-config.json            #   Xray é…ç½®ï¼ˆé€šç”¨ï¼‰
â”‚   â”œâ”€â”€ nginx-proxy.conf            #   nginx åä»£æ¨¡æ¿
â”‚   â”œâ”€â”€ sub-template.yaml           #   Clash/Stash è®¢é˜…æ¨¡æ¿
â”‚   â””â”€â”€ README.md                   #   éƒ¨ç½²æŒ‡å—

â”œâ”€â”€ docs/                            # ğŸ“„ æ–‡æ¡£ + å“ç‰Œèµ„æº
â”‚   â”œâ”€â”€ STRUCTURE.md                 #   æœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ SERVERS.md                   #   æœåŠ¡å™¨æ¸…å•ä¸ç™»å½•æ–¹å¼
â”‚   â”œâ”€â”€ logo.jpg                     #   Logo
â”‚   â””â”€â”€ qrcode-group.jpg            #   ç¾¤èŠäºŒç»´ç 
â”‚
â”œâ”€â”€ _reference/                      # ğŸ“š ç¬¬ä¸‰æ–¹å‚è€ƒé¡¹ç›®ï¼ˆåªè¯»ï¼‰
â”‚   â”œâ”€â”€ kiro-gateway/                #   ä¸Šæ¸¸ kiro-gateway åŸç‰ˆ
â”‚   â”œâ”€â”€ 9router-master/              #   9router å‚è€ƒ
â”‚   â””â”€â”€ ...                          #   å…¶ä»–å‚è€ƒ
â”‚
â””â”€â”€ _archive/                        # ğŸ—„ï¸ å½’æ¡£ï¼ˆä¸å‚ä¸å¼€å‘ï¼‰
    â”œâ”€â”€ gateway_debug/               #   é€†å‘åˆ†æè„šæœ¬
    â”œâ”€â”€ gateway_dev/                 #   æ—§ç‰ˆå¼€å‘ä»£ç 
    â”œâ”€â”€ gateway_ref/                 #   æ—§ç‰ˆå‚è€ƒæ–‡ä»¶
    â””â”€â”€ trace_logs/                  #   å†å² trace æ—¥å¿—
```

## æ¶æ„åˆ†å±‚

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  routes/          è·¯ç”±å±‚ï¼ˆHTTP å…¥å£ï¼‰         â”‚
â”‚  â”œâ”€â”€ proxy.py     OpenAI å…¼å®¹ API            â”‚
â”‚  â”œâ”€â”€ admin.py     ç®¡ç†å‘˜ API                 â”‚
â”‚  â””â”€â”€ user.py      ç”¨æˆ· API                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  services/        ä¸šåŠ¡æœåŠ¡å±‚                  â”‚
â”‚  â”œâ”€â”€ token_pool   Token æ±  + ç”¨æˆ· + é…é¢     â”‚
â”‚  â””â”€â”€ auth_bridge  å‡­è¯ â†’ AuthManager         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  core/            Kiro API æ ¸å¿ƒåº“ï¼ˆä¸Šæ¸¸ï¼‰     â”‚
â”‚  â”œâ”€â”€ converters   æ ¼å¼è½¬æ¢                    â”‚
â”‚  â”œâ”€â”€ streaming    æµå¼å¤„ç†                    â”‚
â”‚  â”œâ”€â”€ compression  ä¸Šä¸‹æ–‡å‹ç¼©                  â”‚
â”‚  â”œâ”€â”€ auth         è®¤è¯ç®¡ç†                    â”‚
â”‚  â””â”€â”€ http_client  HTTP å®¢æˆ·ç«¯                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  db/              æ•°æ®å±‚                      â”‚
â”‚  â””â”€â”€ schema.sql   PostgreSQL DDL             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æœåŠ¡å™¨éƒ¨ç½²

- ç”Ÿäº§æœåŠ¡å™¨: `api.apolloinn.site` (AWS EC2, Ohio)
  - ä»£ç è·¯å¾„: `/opt/apollo/`
  - æœåŠ¡: `systemctl restart apollo`
- æµ‹è¯•æœåŠ¡å™¨: `test.apolloinn.site` (Vultr, æ–°åŠ å¡)
  - ä»£ç è·¯å¾„: `/opt/apollo/`
  - æœåŠ¡: `systemctl restart apollo`
- ä»£ç†èŠ‚ç‚¹: `proxy-sg.apolloinn.site` / `proxy-us.apolloinn.site`
  - é…ç½®æ¨¡æ¿: æœ¬åœ° `proxy/` ç›®å½•

è¯¦ç»†ç™»å½•ä¿¡æ¯è§ `docs/SERVERS.md`ã€‚

æ³¨æ„ï¼šæœåŠ¡å™¨ä¸Šçš„ `/opt/apollo/` å¯¹åº”æœ¬åœ°çš„ `server/` ç›®å½•ã€‚
æœåŠ¡å™¨å¯åŠ¨å‘½ä»¤: `uvicorn app:app --host 0.0.0.0 --port 8000`
